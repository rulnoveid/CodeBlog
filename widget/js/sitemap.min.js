function categorysSitemap(){
  const labels = {};
  const maxResults = 150;
  let start = 1;
  let html = '';
  async function loadFeed(startIndex){
    const feedUrl = `/feeds/posts/default?alt=json&max-results=${maxResults}&start-index=${startIndex}`;
    const response = await fetch(feedUrl);
    const json = await response.json();
    const totalResults = json.feed.openSearch$totalResults.$t;
    if(startIndex === 1){
      html += `<p>Total <b>${totalResults}</b> artikel. <a class='extLrss' target='_blank' href='/feeds/posts/default' rel='noopener' title='Posting artikel RSS' style='color:inherit'>Posting artikel RSS</a></p>`;
    }
    json.feed.entry.forEach((entry) => {
      const label = entry.category[0].term;
      if(!labels[label]){
        labels[label] = [];
      }
      labels[label].push({title: entry.title.$t, url: entry.link.find((link) => link.rel === 'alternate').href})
    })
    if(startIndex + maxResults < totalResults){
      startIndex += maxResults;
      await loadFeed(startIndex);
    }
  }
  loadFeed(start).then(() => {
    Object.entries(labels).sort((a, b) => {
      return b[1].length - a[1].length;
    }).forEach(([label, entries]) => {
      html += `<details><summary>${label} [${entries.length}]</summary><ol>`;
      entries.forEach(({title, url}) => {
        html += `<li><a href="${url}">${title}</a></li>`;
      });
      html += '</ol></details>'
      document.querySelector('#sitemappage').innerHTML = html
    });
  }).catch((error) => {
    console.error(error)
  })
}
window.addEventListener('DOMContentLoaded', categorysSitemap());

const preloader = document.querySelector(".loading");
const preloaderDuration = 1200;

const hidePreloader = () => {
    setTimeout(() => {
        preloader.classList.add("hide");
    }, preloaderDuration);
}
window.addEventListener("load", hidePreloader);